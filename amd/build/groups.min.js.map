{"version":3,"file":"groups.min.js","sources":["../src/groups.js"],"sourcesContent":["\ndefine(['jquery', 'core/str', 'core/modal_factory', 'core/modal_events', 'core/fragment', 'core/templates', 'core/ajax'], function($, Str, Modal, ModalEvents, Fragment, Templates, AJAX) {\n    \n    return {\n        init: function(contextID) {\n            \n            var groupModal = document.getElementsByClassName('group-widget-viewmembers');\n            Array.from(groupModal).forEach(function(element) {\n                element.addEventListener('click', function(e) {\n                    e.preventDefault();\n                    var target = e.target;\n                    group = target.getAttribute('data-group');\n                    Modal.create({\n                        title: Str.get_string('groups', 'core')\n                    }).then(function(modal) {\n                        modal.show();\n                        modal.getRoot().on(ModalEvents.shown, function() {\n                            var args = JSON.stringify({group: group});\n                            var params = {widget: 'groups', method: 'viewmembers', args: args};\n                            var form = Fragment.loadFragment('block_dash', 'loadwidget', contextID, params).then((html, js) => {\n                                modal.setBody(html);\n                                Templates.runTemplateJS(js);\n                            });\n                        })\n                        modal.getRoot().on(ModalEvents.hidden, function() {\n                            modal.destroy();\n                        });\n                    })\n                });\n            });\n\n            var groupUsers = document.getElementsByClassName('add-group-users');\n            Array.from(groupUsers).forEach(function(element) {\n                element.addEventListener('click', function(e) {\n                    e.preventDefault();\n                    var target = e.target;\n                    group = target.getAttribute('data-group');\n                    Modal.create({\n                        type: Modal.types.SAVE_CANCEL,\n                        title: Str.get_string('widget:groups:adduser', 'block_dash'),\n                    }).then(function(modal) {\n                        modal.setLarge(true);\n                        modal.show();\n                        modal.getRoot().on(ModalEvents.shown, function() {\n                            var args = JSON.stringify({group: group});\n                            var params = {widget: 'groups', method: 'addmembers', args: args};\n                            var form = Fragment.loadFragment('block_dash', 'loadwidget', contextID, params).then((html, js) => {\n                                modal.setBody(html);\n\n                                modal.getRoot().get(0).querySelectorAll('form').forEach(form => {\n                                    form.addEventListener('submit', function(e) {\n                                        e.preventDefault();\n                                        formdata = new FormData(e.target);\n                                        if (e.target.querySelector('[name=\"users[]\"]').value == '') {\n                                            return false;\n                                        }\n                                        console.log(e.target.querySelector('[name=\"users[]\"]').value);\n                                        var formdatastr = new URLSearchParams(formdata).toString();\n                                        var promises = AJAX.call([{\n                                            methodname: 'block_dash_groups_add_members',\n                                            args: {formdata: formdatastr}\n                                        }]);\n\n                                        promises[0].done((response) => {\n                                            if (response == true) {\n                                                window.location.reload();\n                                            } else {\n                                                // TODO: Error Notification.\n                                            }\n                                        });\n                                    });\n                                });\n\n                                Templates.runTemplateJS(js);\n                            });\n                        })\n                        modal.getRoot().on(ModalEvents.hidden, function() {\n                            modal.destroy();\n                        });\n\n                        // Apply and save method.\n                        modal.getRoot().on(ModalEvents.save, (e) => {\n                            e.preventDefault();\n                            var formdata = {};\n                            modal.getRoot().get(0).querySelectorAll('form').forEach(form => {\n                                var r = form.querySelector('#id_submitbutton').click();\n                            });\n                        });\n                    })\n                });\n            });\n\n            // Leave group.\n            var leaveGroupModal = document.getElementsByClassName('group-widget-leavegroup');\n            Array.from(leaveGroupModal).forEach(function(element) {\n                element.addEventListener('click', function(e) {\n                    e.preventDefault();\n                    var target = e.target;\n                    group = target.getAttribute('data-group');\n                    Modal.create({\n                        type: Modal.types.SAVE_CANCEL,\n                        title: Str.get_string('groups', 'core' ),\n                    }).then(function(modal) {\n                        modal.show();\n                        modal.getRoot().on(ModalEvents.shown, function() {\n                            var args = JSON.stringify({group: group});\n                            var params = {widget: 'groups', method: 'viewmembers', args: args};\n                            var form = Fragment.loadFragment('block_dash', 'loadwidget', contextID, params).then((html, js) => {\n                                modal.setBody(html);\n                                Templates.runTemplateJS(js);\n                            });\n                        })\n                        modal.getRoot().on(ModalEvents.save, (e) => {\n                            e.preventDefault();\n                            var promises = AJAX.call([{\n                                methodname: 'block_dash_groups_leave_group',\n                                args: {groupid: group}\n                            }]);\n\n                            promises[0].done((response) => {\n                                if (response == true) {\n                                    window.location.reload();\n                                } else {\n                                    // TODO: Error Notification.\n                                }\n                            });\n                        });\n\n                        modal.getRoot().on(ModalEvents.hidden, function() {\n                            modal.destroy();\n                        });\n                    })\n                });\n            });\n\n            // Create group.\n            var createGroupModal = document.getElementsByClassName('create-group');\n            Array.from(createGroupModal).forEach(function(element) {\n                element.addEventListener('click', function(e) {\n                    e.preventDefault();\n                    var target = e.target;\n                    group = target.getAttribute('data-group');\n                    Modal.create({\n                        type: Modal.types.SAVE_CANCEL,\n                        title: Str.get_string('groups', 'core'),\n                    }).then(function(modal) {\n                        modal.show();\n                        modal.getRoot().on(ModalEvents.shown, function() {\n                            var args = \"\";\n                            var params = {widget: 'groups', method: 'creategroup', args: args};\n                            var form = Fragment.loadFragment('block_dash', 'loadwidget', contextID, params).then((html, js) => {\n                                modal.setBody(html);\n                                Templates.runTemplateJS(js);\n                                modal.getRoot().get(0).querySelectorAll('form').forEach(form => {\n                                    form.addEventListener('submit', function(e) {\n                                        e.preventDefault();\n                                        formdata = new FormData(e.target);\n                                        if (e.target.querySelector('[name=\"name\"]').value == \"\" || e.target.querySelector('[name=\"courseid\"]').value == '') {\n                                            return false;\n                                        }\n                                        var formdatastr = new URLSearchParams(formdata).toString();\n                                        var promises = AJAX.call([{\n                                            methodname: 'block_dash_groups_create_group',\n                                            args: {formdata: formdatastr}\n                                        }]);\n\n                                        promises[0].done((response) => {\n                                            if (response == true) {\n                                                window.location.reload();\n                                            } else {\n                                                // TODO: Error Notification.\n                                            }\n                                        });\n                                    });\n                                });\n                            });\n                        })\n\n                        // Apply and save method.\n                        modal.getRoot().on(ModalEvents.save, (e) => {\n                            e.preventDefault();\n                            var formdata = {};\n                            modal.getRoot().get(0).querySelectorAll('form').forEach(form => {\n                                var r = form.querySelector('#id_submitbutton').click();\n                            });\n                        });\n\n                        modal.getRoot().on(ModalEvents.hidden, function() {\n                            modal.destroy();\n                        });\n                    })\n                });\n            });\n        }\n    }\n})\n"],"names":["define","$","Str","Modal","ModalEvents","Fragment","Templates","AJAX","init","contextID","groupModal","document","getElementsByClassName","Array","from","forEach","element","addEventListener","e","preventDefault","target","group","getAttribute","create","title","get_string","then","modal","show","getRoot","on","shown","params","widget","method","args","JSON","stringify","loadFragment","html","js","setBody","runTemplateJS","hidden","destroy","groupUsers","type","types","SAVE_CANCEL","setLarge","get","querySelectorAll","form","formdata","FormData","querySelector","value","console","log","formdatastr","URLSearchParams","toString","call","methodname","done","response","window","location","reload","save","click","leaveGroupModal","groupid","createGroupModal"],"mappings":"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"}