define(["jquery","core/log","core/ajax","core/notification","core/modal_events","block_dash/preferences_modal"],function(a,b,c,d,e,f){var g=function(b,c,d){this.root=a(b),this.blockInstanceId=c,this.blockContextid=d,this.currentPage=0,this.blockPreferencesModal=null,this.init()};return g.prototype.BLOCK_CONTENT_SELECTOR=".info-dash-block-content",g.prototype.FILTER_FORM_SELECTOR=".filter-form",g.prototype.init=function(){b.debug("Initializing dash instance",this),this.blockPreferencesModal=new f(this.getRoot().find(".info-dash-edit-preferences"),this.blockContextid,function(a){this.currentPage=0,this.refresh()}.bind(this)),this.getRoot().on("change","select, input",function(c){c.preventDefault(),b.debug("Submitting filter form"),b.debug(c),b.debug(a(c.target).serializeArray()),this.currentPage=0,this.refresh()}.bind(this)),this.getBlockContentArea().on("click",".page-link",function(b){b.preventDefault(),this.currentPage=a(b.target).data("page"),this.refresh()}.bind(this))},g.prototype.getRoot=function(){return this.root},g.prototype.getBlockContentArea=function(){return this.getRoot().find(this.BLOCK_CONTENT_SELECTOR)},g.prototype.getFilterForm=function(){return this.getRoot().find(this.FILTER_FORM_SELECTOR)},g.prototype.getBlockContent=function(){var a={methodname:"block_dash_get_block_content",args:{block_instance_id:this.blockInstanceId,filter_form_data:JSON.stringify(this.getFilterForm().serializeArray()),page:this.currentPage}};return c.call([a])[0]},g.prototype.refresh=function(){this.getBlockContentArea().css("opacity",.5),this.getBlockContent().then(function(a){this.getBlockContentArea().html(a.html),this.getBlockContentArea().css("opacity",1)}.bind(this))["catch"](d.exception)},g});